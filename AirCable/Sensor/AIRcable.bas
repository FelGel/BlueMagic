@ERASE

0 REM BlueSpells Scanner Version 0.1

@INIT 1
2 PRINTU "\n\n\n\rBLUESPELLS"
3 PRINTU " SENSOR V0.1\n\r"
0 REM Set LED on
5 A = pioset 20
0 REM Baud rate for serial line
6 A = baud 1152
0 REM Debug toggle
7 Z = 0
0 REM power for scanning in dBm
8 REM A = defpower 10
300 RESERVED 
400 RESERVED
500 001E377281F0
10 M = 0
0 REM PRINTU "Press 's' "
0 REM PRINTU "to start "
0 REM $300[0] = 0
0 REM TIMEOUTU 1
0 REM INPUTU $300
0 REM IF $300[0] <> 115 THEN 20;
11 RETURN

@IDLE 20
20 PRINTU "\n\rIDLE\n\r"
25 A = slave 3000
26 WAIT 20
30 ALARM 1
49 RETURN

@SLAVE 800 
800 A = link 2 
805 PRINTS "SPP CONNECTED\n\r"
895 RETURN

@ALARM 50
0 REM A = status
0 REM IF A <> 0 THEN 55
0 REM A = master $500

50 M = M + 1
51 IF M = 11 THEN 100
55 PRINTU "\n\r#"
56 PRINTU M
57 PRINTU "  "
58 A = date $400
59 PRINTU $400
60 PRINTU "  "
70 PRINTU "\n\rPress 's' "
75 PRINTU "to stop\n\r"
80 $300[0] = 0
85 TIMEOUTU 1
90 INPUTU $300
91 IF $300[0] = 115 THEN 100
92 A = inquiry -10
93 ALARM 20
95 RETURN

@INQUIRY 900
0 REM Single LED blink to show device found
900 A = pioset 20
905 A = pioclr 20
910 PRINTU $0;
920 PRINTU "\n\r";
925 PRINTS $0;
930 PRINTS "\n\r";
995 RETURN


100 PRINTU "\n\rTERMINATED\n\r"
101 PRINTU "\n\rPress 'r' "
102 PRINTU "to reboot\n\r"
103 PRINTU "\n\rPress any "
104 PRINTU "other key "
105 PRINTU "to resume\n\r"
106 $300[0] = 0
107 TIMEOUTU 1
110 INPUTU $300
111 IF $300[0] = 0 THEN 107;

120 PRINTU $300;
121 PRINTU "\n\r"
122 IF $300[0] = 114 THEN 150
125 M = 0
130 PRINTU "\n\rRESUMING\n\r"
135 GOTO 50
150 PRINTU "REBOOTING\n\r"
155 A = reboot
156 RETURN